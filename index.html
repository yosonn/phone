<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriAI Web - å°ˆæ¥­ç‡Ÿé¤Šèˆ‡æ…¢ç—…ç®¡ç†</title>
    <style>
        :root {
            --primary: #00796b;
            --primary-light: #e0f2f1;
            --secondary: #0288d1;
            --accent: #ffa000;
            --danger: #e53935;
            --success: #43a047;
            --bg: #f5f8f9;
            --sidebar-width: 260px;
            --radius: 16px;
            --shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        body { background-color: var(--bg); color: #2c3e50; min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; }

        /* --- é ‚éƒ¨å°è¦½åˆ— (Top Header) --- */
        .header {
            background: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .menu-btn {
            background: none; border: none; font-size: 24px; color: var(--primary);
            cursor: pointer; margin-right: 15px; display: flex; align-items: center;
        }
        .app-logo { font-size: 1.4rem; font-weight: 900; color: var(--primary); letter-spacing: 1px; }

        /* --- å´é‚Šéš±è—å°è¦½åˆ— (Overlay Sidebar) --- */
        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            position: fixed;
            top: 0;
            left: calc(var(--sidebar-width) * -1); /* é è¨­éš±è—åœ¨å·¦å´ */
            height: 100%;
            z-index: 1002;
            transition: 0.3s ease;
            box-shadow: 5px 0 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .sidebar.open { left: 0; }
        .sidebar-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.3);
            display: none; z-index: 1001;
        }
        .sidebar-overlay.open { display: block; }

        .sidebar-user { padding: 40px 25px 20px; border-bottom: 1px solid #f0f0f0; }
        .nav-menu { list-style: none; padding: 15px 0; }
        .nav-item {
            padding: 15px 30px; display: flex; align-items: center; gap: 15px;
            cursor: pointer; color: #7f8c8d; font-weight: 600; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { background: var(--primary-light); color: var(--primary); }

        /* --- ä¸»è¦å…§å®¹å€ --- */
        .main-content { flex: 1; padding: 25px; max-width: 1200px; margin: 0 auto; width: 100%; }
        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- UI å…ƒä»¶ --- */
        .card { background: #fff; border-radius: var(--radius); padding: 20px; margin-bottom: 25px; box-shadow: var(--shadow); }
        .section-title { font-size: 1.2rem; margin-bottom: 20px; color: #34495e; font-weight: 800; border-left: 5px solid var(--primary); padding-left: 12px; }

        /* --- 1. é¦–é ï¼šé€²åº¦èˆ‡å»ºè­° --- */
        .chart-container { display: flex; align-items: center; gap: 25px; flex-wrap: wrap; }
        .progress-circle {
            width: 130px; height: 130px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            background: conic-gradient(var(--primary) calc(var(--p) * 1%), #eee 0); position: relative;
        }
        .progress-circle::after { content: ""; position: absolute; width: 100px; height: 100px; background: #fff; border-radius: 50%; }
        .progress-text { position: relative; z-index: 10; text-align: center; }
        .progress-text b { font-size: 1.5rem; color: var(--primary); display: block; }

        .recipe-list { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .recipe-item {
            display: flex; align-items: center; gap: 15px; padding: 12px; background: #fafafa; border-radius: 12px;
            border-left: 4px solid var(--secondary);
        }

        /* --- 4. å€‹äººæª”æ¡ˆï¼šè¦–è¦ºåŒ–ç”Ÿç†æ•¸æ“š (å¼·åŒ–ç‰ˆ) --- */
        .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .avatar { width: 70px; height: 70px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.5rem; }
        
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; }
        .data-box { 
            background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #eee; text-align: center;
            transition: 0.3s; 
        }
        .data-box:hover { border-color: var(--primary); transform: translateY(-3px); }
        .data-label { font-size: 0.8rem; color: #95a5a6; margin-bottom: 8px; display: block; }
        .data-val { font-size: 1.3rem; font-weight: bold; color: var(--primary); }
        .data-unit { font-size: 0.75rem; color: #bdc3c7; }
        
        /* è¦–è¦ºåŒ–ç‹€æ…‹æ¢ */
        .status-bar { height: 6px; background: #eee; border-radius: 3px; margin-top: 10px; overflow: hidden; }
        .status-fill { height: 100%; width: 0; transition: 1s; }
        .status-normal { background: var(--success); }
        .status-warn { background: var(--accent); }
        .status-danger { background: var(--danger); }

        /* --- æ­·å²ç´€éŒ„æ¸…å–® --- */
        .log-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .log-card { cursor: pointer; border-radius: 12px; overflow: hidden; background: #fff; box-shadow: var(--shadow); }
        .log-img { width: 100%; height: 120px; object-fit: cover; }
        .log-info { padding: 10px; font-size: 0.9rem; }

        /* --- è©³æƒ…é é¢ --- */
        .detail-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; color: var(--primary); cursor: pointer; }
        .detail-img { width: 100%; max-height: 300px; object-fit: contain; border-radius: 12px; background: #000; margin-bottom: 20px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* --- è¼‰å…¥ä¸­ --- */
        .loader { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #eee; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* æ‰‹æ©ŸæŒ‰éˆ• */
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }
    </style>
</head>
<body>

    <header class="header">
        <button class="menu-btn" onclick="app.toggleSidebar(true)">â˜°</button>
        <div class="app-logo">NutriAI Web</div>
    </header>

    <div class="sidebar-overlay" id="overlay" onclick="app.toggleSidebar(false)"></div>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-user">
            <h3 style="color:var(--primary)">é¸å–®å°è¦½</h3>
            <p style="font-size:0.85rem; color:#999; margin-top:5px;">æ‚£è€…ï¼šå³å®¥è¾° (Yu-Chen)</p>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="app.navTo('home', this)">ğŸ“Š æ•¸æ“šç¸½è¦½</li>
            <li class="nav-item" onclick="app.navTo('add', this)">ğŸ“¸ å½±åƒè¾¨è­˜</li>
            <li class="nav-item" onclick="app.navTo('history', this)">ğŸ“œ é£²é£Ÿæ—¥èªŒ</li>
            <li class="nav-item" onclick="app.navTo('profile', this)">ğŸ‘¤ å€‹äººæª”æ¡ˆ</li>
        </ul>
        <div style="margin-top:auto; padding:20px; font-size:0.75rem; color:#ccc;">
            NDHU è³‡ç®¡å°ˆé¡Œå±•ç¤º V3.1
        </div>
    </nav>

    <main class="main-content">

        <section id="view-home" class="screen active">
            <div class="card">
                <div class="chart-container">
                    <div class="progress-circle" style="--p: 58">
                        <div class="progress-text"><b>1,250</b><small>kcal</small></div>
                    </div>
                    <div style="flex:1">
                        <h4 style="color:var(--primary)">ä»Šæ—¥ç›®æ¨™ï¼š58%</h4>
                        <p style="font-size:0.85rem; color:#7f8c8d; margin-top:5px;">ç›®å‰ç¢³æ°´åŒ–åˆç‰©æ¯”ä¾‹ç¨é«˜ï¼Œå»ºè­°æ™šé¤é¸æ“‡é«˜è›‹ç™½è³ªé¤é»ã€‚</p>
                    </div>
                </div>
            </div>

            <div class="section-title">ä»Šæ—¥å»ºè­°é£Ÿè­œ</div>
            <div class="recipe-list">
                <div class="recipe-item"><span>ğŸ³</span> <b>æ—©é¤ï¼š</b> ç„¡ç³–è±†æ¼¿ + å…¨éº¥å …æœåå¸ (320 kcal)</div>
                <div class="recipe-item" style="border-left-color: var(--primary);"><span>ğŸ±</span> <b>åˆé¤ï¼š</b> æ¸…è’¸é­šè‚‰ + ç³™ç±³é£¯ + è”¬èœ (650 kcal)</div>
                <div class="recipe-item" style="border-left-color: var(--accent);"><span>ğŸ¥˜</span> <b>æ™šé¤ï¼š</b> å«©è±†è…è‚‰ç‡¥çµ²ç“œ (480 kcal)</div>
            </div>
        </section>

        <section id="view-add" class="screen">
            <div class="card" id="upload-ui">
                <div style="border: 2px dashed #ccc; height: 250px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fafafa; border-radius: 12px; cursor: pointer;" onclick="document.getElementById('file-input').click()">
                    <input type="file" id="file-input" hidden accept="image/*" onchange="app.handleFile(this)">
                    <div id="placeholder"><p style="font-size: 3rem;">ğŸ“¸</p><p>ä¸Šå‚³é¤é»ç…§ç‰‡</p></div>
                    <img id="preview-img" src="" style="display:none; max-width:100%; max-height:100%; border-radius:8px;">
                </div>
                <button class="btn" style="margin-top:20px;" onclick="app.analyze()">æ™ºæ…§å½±åƒè¾¨è­˜</button>
            </div>

            <div id="result-ui" style="display: none;">
                <div class="card">
                    <h2 id="res-food-name" style="margin-bottom:15px; color:var(--primary);">--</h2>
                    <img id="res-img" src="" class="detail-img">
                    <div class="stat-grid">
                        <div class="data-box"><span class="data-label">ç†±é‡</span><b class="data-val" id="res-kcal">--</b> <span class="data-unit">kcal</span></div>
                        <div class="data-box"><span class="data-label">è›‹ç™½è³ª</span><b class="data-val" id="res-p">--</b> <span class="data-unit">g</span></div>
                        <div class="data-box"><span class="data-label">ç¢³æ°´</span><b class="data-val" id="res-c">--</b> <span class="data-unit">g</span></div>
                        <div class="data-box"><span class="data-label">è³ªåœ°</span><b class="data-val" id="res-iddsi">--</b></div>
                    </div>
                    <button class="btn" style="margin-top:20px;" onclick="app.saveLog()">å­˜å…¥é£²é£Ÿæ—¥èªŒ</button>
                </div>
            </div>
        </section>

        <section id="view-history" class="screen">
            <div class="section-title">é£²é£Ÿæ­·å²æ—¥èªŒ</div>
            <div class="log-grid" id="history-container"></div>
        </section>

        <section id="view-detail" class="screen">
            <div class="detail-header" onclick="app.navTo('history')">â† è¿”å›åˆ—è¡¨</div>
            <div class="card" id="detail-content"></div>
        </section>

        <section id="view-profile" class="screen">
            <div class="profile-header">
                <div class="avatar">å³</div>
                <div>
                    <h2>å³å®¥è¾° (Yu-Chen)</h2>
                    <p style="color:#888;">20 æ­² | åœ‹ç«‹æ±è¯å¤§å­¸ | ç”·æ€§</p>
                </div>
            </div>

            <div class="section-title">ç”Ÿç†æ•¸æ“šèˆ‡æŒ‡æ¨™</div>
            <div class="data-grid">
                <div class="data-box">
                    <span class="data-label">BMI æŒ‡æ•¸</span>
                    <b class="data-val">22.4</b> <span class="data-unit">kg/mÂ²</span>
                    <div class="status-bar"><div class="status-fill status-normal" style="width: 50%;"></div></div>
                </div>
                <div class="data-box">
                    <span class="data-label">è¡€å£“ (æ”¶ç¸®/èˆ’å¼µ)</span>
                    <b class="data-val">128 / 84</b> <span class="data-unit">mmHg</span>
                    <div class="status-bar"><div class="status-fill status-warn" style="width: 75%;"></div></div>
                </div>
                <div class="data-box">
                    <span class="data-label">ç©ºè…¹è¡€ç³–</span>
                    <b class="data-val">98</b> <span class="data-unit">mg/dL</span>
                    <div class="status-bar"><div class="status-fill status-normal" style="width: 45%;"></div></div>
                </div>
                <div class="data-box">
                    <span class="data-label">HbA1c ç³–åŒ–è¡€è‰²ç´ </span>
                    <b class="data-val">5.8</b> <span class="data-unit">%</span>
                    <div class="status-bar"><div class="status-fill status-normal" style="width: 55%;"></div></div>
                </div>
                <div class="data-box">
                    <span class="data-label">ç¸½è†½å›ºé†‡</span>
                    <b class="data-val">192</b> <span class="data-unit">mg/dL</span>
                    <div class="status-bar"><div class="status-fill status-warn" style="width: 65%;"></div></div>
                </div>
                <div class="data-box">
                    <span class="data-label">å°¿é…¸å€¼</span>
                    <b class="data-val">7.2</b> <span class="data-unit">mg/dL</span>
                    <div class="status-bar"><div class="status-fill status-danger" style="width: 85%;"></div></div>
                </div>
            </div>

            <div class="card" style="margin-top:25px; border-left: 5px solid var(--accent);">
                <h4>ğŸ‘¨â€âš•ï¸ æ…¢æ€§ç—…ç®¡ç†æç¤º</h4>
                <p style="font-size: 0.9rem; color: #666; margin-top:10px;">
                    æ‚¨çš„å°¿é…¸å€¼åé«˜ï¼Œå»ºè­°æ¯æ—¥é£²æ°´é‡éœ€é”åˆ° 2,500ccï¼Œä¸¦åš´æ ¼é™åˆ¶é«˜æ™®æ—é£Ÿç‰©ï¼ˆå¦‚å…§è‡Ÿã€å¸¶æ®¼æµ·é®®ï¼‰çš„æ”å–ã€‚
                </p>
            </div>
        </section>

    </main>

    <div id="loading" class="loader">
        <div class="spinner"></div>
        <p style="margin-top:15px; color:var(--primary); font-weight:bold;">VLM å½±åƒè¾¨è­˜ä¸­...</p>
    </div>

    <script>
        const app = {
            history: [
                { id: 1, name: 'ç…é®­é­šç©€ç‰©é£¯', kcal: 540, p: 32, c: 55, iddsi: 'L7', img: 'https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=500&q=80', date: '2026-02-08 12:30' },
                { id: 2, name: 'é›è‚‰å …æœæ²™æ‹‰', kcal: 420, p: 28, c: 15, iddsi: 'L7', img: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=500&q=80', date: '2026-02-08 08:15' }
            ],
            current: null,

            toggleSidebar: function(open) {
                document.getElementById('sidebar').classList.toggle('open', open);
                document.getElementById('overlay').classList.toggle('open', open);
            },

            navTo: function(screenId, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('view-' + screenId).classList.add('active');
                if(el) {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    el.classList.add('active');
                }
                this.toggleSidebar(false);
                if(screenId === 'history') this.renderHistory();
                window.scrollTo(0,0);
            },

            handleFile: function(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('preview-img').src = e.target.result;
                        document.getElementById('preview-img').style.display = 'block';
                        document.getElementById('placeholder').style.display = 'none';
                        this.current = { img: e.target.result };
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            },

            analyze: function() {
                if(!this.current) return alert("è«‹å…ˆé¸æ“‡ç…§ç‰‡");
                document.getElementById('loading').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('upload-ui').style.display = 'none';
                    document.getElementById('result-ui').style.display = 'block';
                    
                    const mock = { name: "ç…é®­é­šç©€ç‰©é£¯", kcal: 540, p: 32, c: 55, iddsi: "L7" };
                    this.current = { ...this.current, ...mock };
                    
                    document.getElementById('res-food-name').innerText = mock.name;
                    document.getElementById('res-img').src = this.current.img;
                    document.getElementById('res-kcal').innerText = mock.kcal;
                    document.getElementById('res-p').innerText = mock.p;
                    document.getElementById('res-c').innerText = mock.c;
                    document.getElementById('res-iddsi').innerText = mock.iddsi;
                }, 1500);
            },

            saveLog: function() {
                this.history.unshift({ ...this.current, id: Date.now(), date: new Date().toLocaleString() });
                alert("å·²æˆåŠŸå­˜å…¥æ—¥èªŒ");
                this.navTo('history');
                // Reset
                document.getElementById('upload-ui').style.display = 'block';
                document.getElementById('result-ui').style.display = 'none';
                document.getElementById('preview-img').style.display = 'none';
                document.getElementById('placeholder').style.display = 'flex';
                this.current = null;
            },

            renderHistory: function() {
                const container = document.getElementById('history-container');
                container.innerHTML = this.history.map(item => `
                    <div class="log-card" onclick="app.showDetail(${item.id})">
                        <img src="${item.img}" class="log-img">
                        <div class="log-info">
                            <b>${item.name}</b><br>
                            <span style="color:var(--primary)">${item.kcal} kcal</span>
                        </div>
                    </div>
                `).join('');
            },

            showDetail: function(id) {
                const item = this.history.find(x => x.id === id);
                document.getElementById('detail-content').innerHTML = `
                    <h2 style="margin-bottom:15px; color:var(--primary);">${item.name}</h2>
                    <img src="${item.img}" class="detail-img">
                    <div class="stat-grid">
                        <div class="data-box"><span class="data-label">ç†±é‡</span><b class="data-val">${item.kcal}</b> kcal</div>
                        <div class="data-box"><span class="data-label">è›‹ç™½è³ª</span><b class="data-val">${item.p}</b> g</div>
                        <div class="data-box"><span class="data-label">ç¢³æ°´</span><b class="data-val">${item.c}</b> g</div>
                        <div class="data-box"><span class="data-label">è³ªåœ°</span><b class="data-val">${item.iddsi}</b></div>
                    </div>
                    <p style="margin-top:20px; color:#888; font-size:0.85rem;">ç´€éŒ„æ—¥æœŸï¼š${item.date}</p>
                `;
                this.navTo('detail');
            }
        };

        app.renderHistory();
    </script>
</body>
</html>
