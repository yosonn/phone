<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriAI Web V3 - é†«ç”¨ç´šæ•¸æ“šè¦–è¦ºåŒ–</title>
    <style>
        :root {
            --primary: #00796b;
            --primary-light: #e0f2f1;
            --secondary: #0288d1;
            --accent: #ffa000;
            --danger: #e53935;
            --success: #43a047;
            --bg: #f0f4f7;
            --sidebar-width: 260px;
            --radius: 16px;
            --shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        body { background-color: var(--bg); display: flex; min-height: 100vh; color: #2c3e50; }

        /* --- å·¦å´å´é‚Šæ¬„ (Sidebar) --- */
        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            border-right: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 40px 25px;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            letter-spacing: 1px;
        }

        .nav-menu { list-style: none; padding: 10px 0; flex-grow: 1; }
        .nav-item {
            padding: 18px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            color: #7f8c8d;
            font-weight: 600;
            transition: all 0.3s;
        }
        .nav-item:hover, .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
            border-right: 5px solid var(--primary);
        }

        /* --- ä¸»è¦å…§å®¹å€ --- */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 40px;
            max-width: 1200px;
        }

        .screen { display: none; animation: slideUp 0.4s ease-out; }
        .screen.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- è¦–è¦ºåŒ–å¡ç‰‡å…ƒä»¶ --- */
        .card { background: #fff; border-radius: var(--radius); padding: 25px; margin-bottom: 30px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.02); }
        .section-title { font-size: 1.3rem; margin-bottom: 25px; color: #34495e; font-weight: 800; border-left: 5px solid var(--primary); padding-left: 15px; }

        /* é€²åº¦åœ“é¤…åœ– (CSS Conic-gradient) */
        .chart-container { display: flex; align-items: center; gap: 40px; margin-bottom: 20px; flex-wrap: wrap; }
        .progress-circle {
            width: 150px; height: 150px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: conic-gradient(var(--primary) calc(var(--p) * 1%), #eee 0);
            position: relative;
        }
        .progress-circle::after {
            content: ""; position: absolute; width: 120px; height: 120px; background: #fff; border-radius: 50%;
        }
        .progress-text { position: relative; z-index: 10; text-align: center; }
        .progress-text b { font-size: 1.8rem; color: var(--primary); display: block; }

        /* ä¸‰é¤å»ºè­°é£Ÿè­œ */
        .meal-plan { display: flex; flex-direction: column; gap: 15px; }
        .recipe-item {
            display: flex; align-items: center; gap: 20px; padding: 15px;
            border-radius: 12px; background: #fafafa; border: 1px solid #f0f0f0; transition: 0.2s;
        }
        .recipe-item:hover { transform: translateX(5px); border-color: var(--primary); }
        .meal-icon { font-size: 2rem; width: 60px; height: 60px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* æ­·å²ç´€éŒ„èˆ‡è©³æƒ… */
        .log-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .log-card { overflow: hidden; cursor: pointer; transition: 0.3s; }
        .log-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .log-thumb { width: 100%; height: 180px; object-fit: cover; }
        .log-body { padding: 15px; }

        /* è©³æƒ…é é¢æ¨£å¼ (å¤§åœ–èˆ‡æ•¸æ“š) */
        .detail-view { display: flex; gap: 30px; flex-wrap: wrap; }
        .detail-img-box { flex: 1; min-width: 300px; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); }
        .detail-img-box img { width: 100%; height: auto; display: block; }
        .detail-info { flex: 1.2; min-width: 300px; }

        /* ç‡Ÿé¤Šæ•¸å€¼è¦–è¦ºåŒ–å°å¡ */
        .nutri-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-box { padding: 15px; border-radius: 12px; text-align: center; background: #f8fafc; border-bottom: 4px solid #ddd; }
        .stat-box.kcal { border-color: var(--secondary); }
        .stat-box.protein { border-color: var(--success); }
        .stat-box.carbs { border-color: var(--accent); }
        .stat-box.iddsi { border-color: #546e7a; }
        .stat-label { font-size: 0.8rem; color: #7f8c8d; margin-bottom: 5px; display: block; }
        .stat-val { font-size: 1.4rem; font-weight: bold; }

        /* å…¶ä»–å…ƒä»¶ */
        .btn { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn:hover { background: var(--primary-dark); opacity: 0.9; }

        @media (max-width: 900px) {
            .sidebar { transform: translateX(-100%); width: 0; }
            .main-content { margin-left: 0; padding: 20px; }
            .nav-item { padding: 18px 20px; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-header">NutriAI Web</div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="app.navTo('home', this)">ğŸ“Š æ•¸æ“šç¸½è¦½</li>
            <li class="nav-item" onclick="app.navTo('add', this)">ğŸ“¸ å½±åƒè¾¨è­˜</li>
            <li class="nav-item" onclick="app.navTo('history', this)">ğŸ“œ é£²é£Ÿæ—¥èªŒ</li>
            <li class="nav-item" onclick="app.navTo('profile', this)">ğŸ‘¤ æ…¢ç—…æŒ‡æ¨™</li>
        </ul>
        <div style="padding: 25px; border-top: 1px solid #f0f0f0; font-size: 0.85rem; color: #95a5a6;">
            æ‚£è€…ï¼šå³å®¥è¾° (Yu-Chen)<br>NDHU è³‡ç®¡ç³»å¤§ä¸‰å°ˆé¡Œ
        </div>
    </nav>

    <main class="main-content">
        
        <section id="view-home" class="screen active">
            <h2 class="section-title">ä»Šæ—¥ç‡Ÿé¤Šè¿½è¹¤ç¸½è¦½</h2>
            <div class="card">
                <div class="chart-container">
                    <div class="progress-circle" id="cal-circle" style="--p: 58">
                        <div class="progress-text">
                            <b id="home-kcal-val">1,250</b>
                            <small>å·²æ”å–å¡è·¯é‡Œ</small>
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <h4 style="margin-bottom:10px;">ç›®æ¨™é”æˆåº¦ï¼š58%</h4>
                        <p style="color:#7f8c8d; font-size:0.9rem; line-height:1.6;">
                            æ‚¨ä»Šå¤©çš„ç›®æ¨™æ”å–é‡ç‚º 2,150 kcalã€‚ç›®å‰ç¢³æ°´åŒ–åˆç‰©æ¯”ä¾‹ç¨é«˜ï¼Œå»ºè­°æ™šé¤é¸æ“‡é«˜è›‹ç™½è³ªã€ä½è„‚çš„é¤é»ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <h2 class="section-title">å€‹äººåŒ–ä¸‰é¤å»ºè­°é£Ÿè­œ</h2>
            <div class="meal-plan">
                <div class="recipe-item">
                    <div class="meal-icon">ğŸ³</div>
                    <div style="flex:1;">
                        <small style="color:var(--primary); font-weight:bold;">æ—©é¤å»ºè­°</small>
                        <h4>ç„¡ç³–è±†æ¼¿ + å…¨éº¥å …æœåå¸</h4>
                        <p style="font-size:0.85rem; color:#666;">ä½è¡€ç³–è² è¼‰(GL)ï¼Œé©åˆæ¸…æ™¨è¡€ç³–ç©©å®šã€‚</p>
                    </div>
                    <div style="text-align:right;">320 kcal</div>
                </div>
                <div class="recipe-item">
                    <div class="meal-icon">ğŸ±</div>
                    <div style="flex:1;">
                        <small style="color:var(--secondary); font-weight:bold;">åˆé¤å»ºè­°</small>
                        <h4>æ¸…è’¸é­šè‚‰ + ç³™ç±³é£¯ + å¤šè‰²è”¬èœ</h4>
                        <p style="font-size:0.85rem; color:#666;">å„ªè³ªè›‹ç™½è³ªèˆ‡è¤‡åˆæ¾±ç²‰ï¼Œç¶­æŒä¸‹åˆé«”åŠ›ã€‚</p>
                    </div>
                    <div style="text-align:right;">650 kcal</div>
                </div>
                <div class="recipe-item">
                    <div class="meal-icon">ğŸ¥˜</div>
                    <div style="flex:1;">
                        <small style="color:var(--accent); font-weight:bold;">æ™šé¤å»ºè­°</small>
                        <h4>å«©è±†è…è‚‰ç‡¥çµ²ç“œ + æ¸…ç‡™ç§‹è‘µ</h4>
                        <p style="font-size:0.85rem; color:#666;">è¼•ç›ˆç„¡è² æ“”ï¼Œå¹«åŠ©å¤œé–“ç¡çœ èˆ‡æ¶ˆåŒ–ã€‚</p>
                    </div>
                    <div style="text-align:right;">480 kcal</div>
                </div>
            </div>
        </section>

        <section id="view-add" class="screen">
            <h2 class="section-title">æ‹ç…§è¨˜éŒ„èˆ‡ AI åˆ†æ</h2>
            <div class="card" id="upload-panel">
                <div style="border: 2px dashed #ccc; border-radius: var(--radius); height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fafafa; cursor: pointer;" onclick="document.getElementById('input-file').click()">
                    <input type="file" id="input-file" hidden accept="image/*" onchange="app.handleUpload(this)">
                    <div id="placeholder">
                        <p style="font-size: 4rem;">ğŸ“¸</p>
                        <p style="font-weight:bold; color:#888;">é»æ“Šä¸Šå‚³é¤é»ç…§ç‰‡</p>
                    </div>
                    <img id="upload-preview" src="" style="display:none; max-width:100%; max-height:100%; border-radius:12px;">
                </div>
                <button class="btn" style="width:100%; margin-top:20px;" onclick="app.startVLM()">å•Ÿå‹•æ™ºæ…§ç‡Ÿé¤Šè¾¨è­˜</button>
            </div>

            <div id="analysis-result" style="display: none;">
                <div class="card">
                    <h2 id="vlm-food-name" style="margin-bottom:20px; color:var(--primary);">--</h2>
                    <div class="detail-view">
                        <div class="detail-img-box"><img id="res-img" src=""></div>
                        <div class="detail-info">
                            <div class="nutri-stat-grid">
                                <div class="stat-box kcal"><span class="stat-label">èƒ½é‡ä¼°ç®—</span><b class="stat-val" id="res-kcal">--</b> kcal</div>
                                <div class="stat-box protein"><span class="stat-label">è›‹ç™½è³ª</span><b class="stat-val" id="res-p">--</b> g</div>
                                <div class="stat-box carbs"><span class="stat-label">ç¢³æ°´åŒ–åˆç‰©</span><b class="stat-val" id="res-c">--</b> g</div>
                                <div class="stat-box iddsi"><span class="stat-label">è³ªåœ°ç­‰ç´š</span><b class="stat-val" id="res-iddsi">--</b></div>
                            </div>
                            <div style="margin-top:25px; padding:15px; background:#fff3e0; border-radius:10px; font-size:0.9rem;">
                                âš ï¸ <b>è²æ˜ï¼š</b>æ­¤æ•¸æ“šç”± VLM è¦–è¦ºæ¨¡å‹ä¼°ç®—ï¼Œåƒ…ä¾›åƒè€ƒï¼Œä¸å…·é†«ç™‚è™•æ–¹æ•ˆåŠ›ã€‚
                            </div>
                            <button class="btn" style="margin-top:20px; width:100%;" onclick="app.saveToLog()">ç¢ºèªå­˜å…¥æ—¥èªŒ</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-history" class="screen">
            <h2 class="section-title">é£²é£Ÿæ—¥èªŒå›é¡§</h2>
            <div class="log-grid" id="history-container">
                </div>
        </section>

        <section id="view-detail" class="screen">
            <button onclick="app.navTo('history')" style="margin-bottom:20px; background:none; border:none; color:var(--primary); font-weight:bold; cursor:pointer;">â† è¿”å›æ—¥èªŒåˆ—è¡¨</button>
            <h2 class="section-title" id="detail-title">é¤é»è©³ç´°è³‡æ–™</h2>
            <div class="card" id="detail-card-content">
                </div>
        </section>

        <section id="view-profile" class="screen">
            <h2 class="section-title">æ…¢æ€§ç—…å¥åº·æŒ‡æ¨™ç›£æ¸¬</h2>
            <div class="card">
                <div class="nutri-stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-box" style="border-color:var(--primary);"><span class="stat-label">æ”¶ç¸®å£“ / èˆ’å¼µå£“</span><b class="stat-val">128 / 84</b><small>mmHg</small></div>
                    <div class="stat-box" style="border-color:var(--accent);"><span class="stat-label">ç©ºè…¹è¡€ç³–</span><b class="stat-val">98</b><small>mg/dL</small></div>
                    <div class="stat-box" style="border-color:var(--danger);"><span class="stat-label">HbA1c ç³–åŒ–è¡€è‰²ç´ </span><b class="stat-val">5.8</b><small>%</small></div>
                    <div class="stat-box" style="border-color:var(--secondary);"><span class="stat-label">ç•¶å‰é«”é‡</span><b class="stat-val">74.5</b><small>kg</small></div>
                </div>
            </div>
        </section>

    </main>

    <div id="loading" style="position:fixed; inset:0; background:rgba(255,255,255,0.9); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:5000;">
        <div style="width:50px; height:50px; border:5px solid #eee; border-top:5px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite;"></div>
        <p style="margin-top:15px; font-weight:bold; color:var(--primary);">AI è¦–è¦ºå¼•æ“é‹ç®—ä¸­...</p>
    </div>

    <style> @keyframes spin { to { transform: rotate(360deg); } } </style>

    <script>
        // --- æ ¸å¿ƒæ‡‰ç”¨é‚è¼¯ ---
        const app = {
            // é è¨­æ­·å²ç´€éŒ„
            history: [
                { id: 101, name: 'ç…é®­é­šç©€ç‰©é£¯', kcal: 540, p: 32, c: 55, iddsi: 'L7', date: '2026-02-08 12:30', img: 'https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=800&q=80' },
                { id: 102, name: 'é›è‚‰å …æœæ²™æ‹‰', kcal: 420, p: 28, c: 15, iddsi: 'L7', date: '2026-02-08 08:15', img: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=800&q=80' }
            ],
            currentAnalysis: null,

            init: function() {
                this.renderHistory();
            },

            navTo: function(screenId, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('view-' + screenId).classList.add('active');
                
                if (el) {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    el.classList.add('active');
                }
                window.scrollTo(0, 0);
            },

            handleUpload: function(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('upload-preview').src = e.target.result;
                        document.getElementById('upload-preview').style.display = 'block';
                        document.getElementById('placeholder').style.display = 'none';
                        this.currentAnalysis = { img: e.target.result };
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            },

            startVLM: function() {
                if (!this.currentAnalysis) { alert("è«‹å…ˆä¸Šå‚³ç…§ç‰‡"); return; }
                
                document.getElementById('loading').style.display = 'flex';
                
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('upload-panel').style.display = 'none';
                    document.getElementById('analysis-result').style.display = 'block';
                    
                    // æ ¹æ“šæ‚¨æä¾›çš„åœ–ç‰‡æ•¸å€¼é€²è¡Œå¡«å……
                    const mock = { 
                        name: "ç…é®­é­šç©€ç‰©é£¯", 
                        kcal: 540, 
                        p: 32, 
                        c: 55, 
                        iddsi: "L7" 
                    };
                    
                    this.currentAnalysis = { ...this.currentAnalysis, ...mock };
                    
                    document.getElementById('vlm-food-name').innerText = mock.name;
                    document.getElementById('res-img').src = this.currentAnalysis.img;
                    document.getElementById('res-kcal').innerText = mock.kcal;
                    document.getElementById('res-p').innerText = mock.p;
                    document.getElementById('res-c').innerText = mock.c;
                    document.getElementById('res-iddsi').innerText = mock.iddsi;
                    
                }, 1800);
            },

            saveToLog: function() {
                const newRecord = { 
                    ...this.currentAnalysis, 
                    id: Date.now(), 
                    date: new Date().toLocaleString() 
                };
                this.history.unshift(newRecord);
                this.renderHistory();
                
                // æ›´æ–°é¦–é æ•¸æ“š (æ¨¡æ“¬)
                const currentTotal = parseInt(document.getElementById('home-kcal-val').innerText.replace(',',''));
                document.getElementById('home-kcal-val').innerText = (currentTotal + newRecord.kcal).toLocaleString();
                
                alert("å·²æˆåŠŸå­˜å…¥é£²é£Ÿæ—¥èªŒ");
                this.navTo('history');
                
                // é‡ç½®ä¸Šå‚³å€
                document.getElementById('upload-panel').style.display = 'block';
                document.getElementById('analysis-result').style.display = 'none';
                document.getElementById('upload-preview').style.display = 'none';
                document.getElementById('placeholder').style.display = 'flex';
                this.currentAnalysis = null;
            },

            renderHistory: function() {
                const container = document.getElementById('history-container');
                container.innerHTML = this.history.map(item => `
                    <div class="card log-card" onclick="app.showDetail(${item.id})">
                        <img src="${item.img}" class="log-thumb">
                        <div class="log-body">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                <b>${item.name}</b>
                                <span style="color:var(--primary); font-weight:bold;">${item.kcal} kcal</span>
                            </div>
                            <small style="color:#999;">${item.date}</small>
                        </div>
                    </div>
                `).join('');
            },

            showDetail: function(id) {
                const item = this.history.find(x => x.id === id);
                if (!item) return;

                const detailCard = document.getElementById('detail-card-content');
                detailCard.innerHTML = `
                    <h2 style="margin-bottom:20px; color:var(--primary);">${item.name}</h2>
                    <div class="detail-view">
                        <div class="detail-img-box"><img src="${item.img}"></div>
                        <div class="detail-info">
                            <div class="nutri-stat-grid">
                                <div class="stat-box kcal"><span class="stat-label">èƒ½é‡ä¼°ç®—</span><b class="stat-val">${item.kcal}</b> kcal</div>
                                <div class="stat-box protein"><span class="stat-label">è›‹ç™½è³ª</span><b class="stat-val">${item.p}</b> g</div>
                                <div class="stat-box carbs"><span class="stat-label">ç¢³æ°´åŒ–åˆç‰©</span><b class="stat-val">${item.c}</b> g</div>
                                <div class="stat-box iddsi"><span class="stat-label">è³ªåœ°ç­‰ç´š</span><b class="stat-val">${item.iddsi}</b></div>
                            </div>
                            <div style="margin-top:25px;">
                                <p style="color:#666;"><b>ç´€éŒ„æ—¥æœŸï¼š</b>${item.date}</p>
                                <p style="color:#666; margin-top:10px;"><b>AI VLM å‚™è¨»ï¼š</b>ç³»çµ±è­˜åˆ¥æ­¤é¤é»è³ªåœ°ç¬¦åˆ IDDSI Level 7 æ¨™æº–ï¼Œå»ºè­°æ­é…å……è¶³æ°´åˆ†æ”å–ã€‚</p>
                            </div>
                        </div>
                    </div>
                `;
                this.navTo('detail');
            }
        };

        app.init();
    </script>
</body>
</html>
